#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

set -e

# Note: secrets-precommit.sh removed; secrets are enforced via CI/gitleaks (see .github/workflows/secret-scan.yml)

STAGED="$(git diff --cached --name-only)"

# 1. E2E specs touched => strict gate + static
if echo "$STAGED" | grep -Eq '^apps/web/e2e/'; then
  echo "⚡ E2E files changed. Running check:fast + check:static..."
  pnpm check:fast
  pnpm check:static
  exit 0
fi

# 2. Code changes => static checks only
if echo "$STAGED" | grep -Eq '(\.ts|\.tsx|\.js|\.jsx|\.mjs|\.cjs)$'; then
  echo "✅ Code changes detected. Running check:static..."
  pnpm check:static
  exit 0
fi

# 3. Everything else (Docs/Config) => Skip
echo "⏩ No code/E2E changes. Skipping checks."
exit 0
