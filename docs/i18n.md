# i18n contract (next-intl)

This repo uses `next-intl` with modular JSON namespaces under `apps/web/src/messages/<locale>/*.json`.

## Goals

- Keep translations modular by namespace (no monolithic `messages.json`).
- Enforce **locale + namespace parity** via tooling.
- Make **missing keys fail fast** in Dev and E2E, while remaining tolerant in Production.
- Keep E2E assertions stable (prefer `data-testid` / structure over localized copy).

## Runtime behavior

The request-time config is implemented in `apps/web/src/i18n/request.ts`.

- **Strict mode** (Dev and E2E):
  - Missing namespace files or missing translation keys throw and fail the request/render.
  - Strict mode is enabled when:
    - `NODE_ENV !== 'production'` (local dev), or
    - `INTERDOMESTIK_AUTOMATED=1` (Playwright E2E / automation)

- **Production mode**:
  - Missing translation keys fall back to returning the full key (e.g. `claims.title`).
  - Missing keys are logged **once** per process.

## File layout

- Messages live at: `apps/web/src/messages/<locale>/<namespace>.json`
- Locales used by routing are defined in: `apps/web/src/i18n/routing.ts`
- Namespace list is defined in: `apps/web/src/i18n/messages.ts` (`MESSAGE_NAMESPACES`).

## Tooling

### Check parity

Runs in `pnpm check:fast`.

- `pnpm i18n:check`
  - Defaults to checking parity across `en`, `sq`, `mk`, `sr`.
  - Uses `en` as the base locale (namespace discovery + key set).

Optional overrides:

- `pnpm i18n:check -- --locales=en,sq,mk,sr`
- `pnpm i18n:check -- --base=en --locales=en,sq,mk`

### Sync parity (optional)

Scaffolds missing locale files/keys from the base locale.

- `pnpm i18n:sync`
  - Defaults to syncing from `en` â†’ `sq,mk,sr`.

Optional overrides:

- `pnpm i18n:sync -- --locales=sq,mk,sr`
- `pnpm i18n:sync -- --dry-run`

## E2E guidance

- Do not assert translated UI strings.
- Prefer stable markers:
  - `data-testid`
  - headings/structure
  - URL/route contracts
  - empty-state markers
