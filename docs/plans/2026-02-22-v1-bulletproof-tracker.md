# V1.0.0 Bulletproof Tracker

Last updated: 2026-02-24
Current phase: M0-A (Gate Foundation)
Plan reference: docs/plans/2026-02-22-v1-bulletproof-program.md
Status command: pnpm v1:status

## Mandatory PR Loop (every PR)

1. Commit scoped changes.
2. Push branch.
3. Wait for CI.
4. Run `pnpm pr:finalize` (verifies required checks and unresolved review threads, including Copilot threads).
5. Address all comments/threads.
6. Push updates.
7. Run `pnpm pr:finalize` again.
8. Merge only when finalizer passes on latest SHA.

## Mandatory Test Delta (A12-A22)

1. If code behavior changes, add/update at least one unit test in the same PR.
2. If boundary/user-flow behavior changes (tenant/auth/api/billing/funnel), add/update integration or e2e coverage in the same PR.
3. Document both test deltas in the action evidence line with exact test command(s) run and pass/fail output references for that action (fully satisfying Test Delta Policy point 5).
4. If no test delta is added for a behavior change, block merge unless Atlas + Sentinel + Gatekeeper approve and note the exception in Notes Log.

## Completed

- [x] P00 - Program ratified and persisted in-repo (this file + program file) | Date: 2026-02-22 | Evidence: git history
- [x] A01 - Required-suite manifest added at `scripts/release-gate/v1-required-specs.json` | Date: 2026-02-22 | Evidence: `jq . scripts/release-gate/v1-required-specs.json` + per-spec file existence check
- [x] A02 - Required-suite no-skip checker added at `scripts/release-gate/check-no-skip.mjs` | Date: 2026-02-22 | Evidence: `node scripts/release-gate/check-no-skip.mjs --manifest scripts/release-gate/v1-required-specs.json` + temp-manifest injected `test.skip` exits 1
- [x] A03 - RC evidence manifest writer added at `scripts/release-gate/write-rc-manifest.mjs` | Date: 2026-02-22 | Evidence: `node scripts/release-gate/write-rc-manifest.mjs --manifest scripts/release-gate/v1-required-specs.json --run-id test-run --results-dir tmp/release-rc/test-run/results --logs-dir tmp/release-rc/test-run/logs` + `jq . tmp/release-rc/test-run/rc.json` + `tmp/release-rc/test-run/rc.json.sha256`
- [x] A04 - Streak anchor/capture scripts added at `scripts/release-gate/streak/compute-anchor.mjs` and `scripts/release-gate/streak/capture-streak.mjs` | Date: 2026-02-22 | Evidence: `node scripts/release-gate/streak/compute-anchor.mjs` + `node scripts/release-gate/streak/capture-streak.mjs` + `tmp/release-streak/2026-02-22/run-2026-02-22T21-19-34-841Z-e012d7af/pack.sha256`
- [x] A05 - Playwright gate reporters emit JUnit/XML and JSON outputs at `apps/web/test-results/junit.xml` and `apps/web/test-results/report.json` | Date: 2026-02-22 | Evidence: `pnpm --filter @interdomestik/web exec playwright test e2e/gate --project=gate-ks-sq --workers=1` + `test -f apps/web/test-results/junit.xml` + `test -f apps/web/test-results/report.json`
- [x] A06 - Release-candidate workflow added at `.github/workflows/release-candidate.yml` | Date: 2026-02-22 | Evidence: `https://github.com/interdomestik/interdomestik/actions/runs/22286625815` + artifact `release-candidate-artifacts-22286625815-1`
- [x] A07 - Secret scan blocking on `release/*` and `rc/*` in security workflows | Date: 2026-02-22 | Evidence: `rg -n "continue-on-error:\\s*true|gitleaks|secret" .github/workflows/security.yml .github/workflows/secret-scan.yml` + PR runs `22287449326` (Security) / `22287449314` (Secret Scan) + RC smoke runs `22287448408` (Security) / `22287448415` (Secret Scan)
- [x] A08 - Enforce mandatory RLS integration for RC (`REQUIRE_RLS_INTEGRATION=1`) | Date: 2026-02-23 | Evidence: `REQUIRE_RLS_INTEGRATION=1 pnpm db:rls:test` exits non-zero when `DATABASE_URL` is missing; `pnpm db:rls:test` preserves local skip ergonomics when DB env is absent; `DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:54322/postgres REQUIRE_RLS_INTEGRATION=1 pnpm db:rls:test` prints `RLS_INTEGRATION_RAN=1`
- [x] A09 - Unify tenant resolver usage in sensitive surfaces | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run src/lib/tenant/tenant-hosts.test.ts` + `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/auth/[...all]/_core.test.ts'` + `KS_HOST=ks.127.0.0.1.nip.io:3000 MK_HOST=mk.127.0.0.1.nip.io:3000 PILOT_HOST=pilot.127.0.0.1.nip.io:3000 pnpm --filter @interdomestik/web exec playwright test e2e/gate/tenant-resolution.spec.ts --project=gate-ks-sq --project=gate-mk-mk --workers=1 --max-failures=1`
- [x] A10 - Enforce member upload ownership | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run src/app/api/uploads/route.test.ts src/features/member/claims/actions.test.ts`
- [x] A11 - Implement fail-closed rate limits on sensitive endpoints | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run src/lib/rate-limit.core.test.ts` + `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/auth/[...all]/route.test.ts' src/app/api/register/route.test.ts src/app/api/webhooks/paddle/route.test.ts src/app/api/uploads/route.test.ts` + `pnpm pr:finalize`
- [x] A14 - Add billing entity mapping and strict env validation (KS/MK/AL). Verify: billing unit tests | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-server.test.ts` (3 passed) + `pnpm --filter @interdomestik/domain-membership-billing test:unit` (42 passed) + `pnpm pr:verify` (fails locally in Playwright gate with `getaddrinfo ENOTFOUND sq`) + `pnpm security:guard` (passed) + `pnpm e2e:gate` (fails locally with `getaddrinfo ENOTFOUND mk`)
- [x] A15 - Add entity-bound webhook routes (`/api/webhooks/paddle/[entity]`) with strict `ks|mk|al` path validation. Verify: webhook route tests | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts' src/app/api/webhooks/paddle/route.test.ts` (5 passed) + `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-server.test.ts` (9 passed) + `pnpm pr:verify` (fails locally in Playwright gate with `getaddrinfo ENOTFOUND sq`) + `pnpm pr:verify:hosts` (fails locally on `e2e/gate/agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`) + `pnpm security:guard` (passed) + `pnpm e2e:gate` (initial local fail with `getaddrinfo ENOTFOUND mk`; host-routed rerun started with `KS_HOST=ks.localhost:3000 MK_HOST=mk.localhost:3000` and was interrupted during Copilot follow-up) + `pnpm i18n:check` (passed)

## Next Up (work top-down)

1. A12 - Add tenant predicates for membership/subscription reads

## Milestone Actions

### M0-A Gate Foundation (2026-02-23 to 2026-02-27)

- [x] A01 - Create required-suite manifest. Verify: `node scripts/release-gate/verify-required-specs.mjs --manifest scripts/release-gate/v1-required-specs.json --playwright-json apps/web/test-results/report.json` | Date: 2026-02-22 | Evidence: `scripts/release-gate/v1-required-specs.json` + `jq` + spec file existence check
- [x] A02 - Enforce no skip/fixme/quarantine in required suites. Verify: `node scripts/release-gate/check-no-skip.mjs --manifest scripts/release-gate/v1-required-specs.json` | Date: 2026-02-22 | Evidence: emits `file:line: matched_token` and exits non-zero on violations
- [x] A03 - Write rc.json evidence contract. Verify: `node scripts/release-gate/write-rc-manifest.mjs --manifest scripts/release-gate/v1-required-specs.json --run-id test-run --results-dir tmp/release-rc/test-run/results --logs-dir tmp/release-rc/test-run/logs` | Date: 2026-02-22 | Evidence: `tmp/release-rc/test-run/rc.json` + `tmp/release-rc/test-run/rc.json.sha256` + `checks.rls_integration_ran=true`
- [x] A04 - Add streak anchor and daily capture scripts. Verify: `node scripts/release-gate/streak/compute-anchor.mjs && node scripts/release-gate/streak/capture-streak.mjs` | Date: 2026-02-22 | Evidence: `anchor_sha=bccc12e6333ebb0f8d916d483d3c4f529ff45ac4` + `tmp/release-streak/2026-02-22/run-2026-02-22T21-19-34-841Z-e012d7af/pack.sha256`
- [x] A05 - Update Playwright to emit JUnit and JSON reports. Verify: `pnpm --filter @interdomestik/web exec playwright test e2e/gate --project=gate-ks-sq --workers=1` | Date: 2026-02-22 | Evidence: `apps/web/playwright.config.ts` reporter includes `junit` + `json` outputFile settings and gate run emits both files in `apps/web/test-results/`
- [x] A06 - Add release-candidate workflow. Verify: run `.github/workflows/release-candidate.yml` on `rc/*` branch | Date: 2026-02-22 | Evidence: run `22286625815` (`rc/pr6-a06-smoke`) uploaded artifact `release-candidate-artifacts-22286625815-1` with release-gate outputs + test results + rc manifest + streak pack
- [x] A07 - Make secret scan blocking on `release/*` and `rc/*`. Verify: workflow triggers on `rc/**` + `release/**`; gitleaks runs blocking in both workflows and uploads SARIF artifact evidence | Date: 2026-02-22 | Evidence: PR runs `22287449326` / `22287449314`; RC smoke runs `22287448408` / `22287448415`

### M0-B Security and Isolation Closure (2026-02-28 to 2026-03-08)

- [x] A08 - Enforce mandatory RLS integration for RC (`REQUIRE_RLS_INTEGRATION=1`). Verify: `REQUIRE_RLS_INTEGRATION=1 pnpm db:rls:test` | Date: 2026-02-23 | Evidence: required mode hard-fails on missing `DATABASE_URL` and missing RLS/policy prerequisites; RC marker is emitted only by integration run path (`RLS_INTEGRATION_RAN=1`)
- [x] A09 - Unify tenant resolver usage in sensitive surfaces. Verify: targeted unit tests + isolation scenario | Date: 2026-02-23 | Evidence: canonical resolver `resolveTenantIdFromSources` is now used by `apps/web/src/lib/proxy-logic.ts`, `apps/web/src/app/api/auth/[...all]/_core.ts`, `apps/web/src/app/api/register/route.ts`, `apps/web/src/app/api/simple-register/route.ts`; targeted unit commands pass and gate isolation contract pass command above is green
- [x] A10 - Enforce member upload ownership. Verify: upload/member action unit tests | Date: 2026-02-23 | Evidence: upload API + member server action enforce claim ownership with safe deny behavior; `pnpm --filter @interdomestik/web test:unit --run src/app/api/uploads/route.test.ts src/features/member/claims/actions.test.ts`
- [x] A11 - Implement fail-closed rate limits on sensitive endpoints. Verify: rate-limit core unit tests | Date: 2026-02-23 | Evidence: strict production-sensitive fail-closed behavior for `/api/auth/*`, `/api/register/*`, `/api/webhooks/paddle/*`, and `/api/uploads` with `503 + Retry-After + RATE_LIMIT_BACKEND_MISSING` in `apps/web/src/lib/rate-limit.core.ts`; `pnpm --filter @interdomestik/web test:unit --run src/lib/rate-limit.core.test.ts`; `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/auth/[...all]/route.test.ts' src/app/api/register/route.test.ts src/app/api/webhooks/paddle/route.test.ts src/app/api/uploads/route.test.ts`; `pnpm pr:finalize`
- [ ] A12 - Add tenant predicates for membership/subscription reads. Verify: membership core unit tests
- [ ] A13 - Add AL dark tenant config and run KS/MK/AL matrix. Verify: scenario suite

### M1 MoR by Tenant Entity (2026-03-09 to 2026-03-22)

- [x] A14 - Add billing entity mapping and strict env validation (KS/MK/AL). Verify: billing unit tests | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-server.test.ts` + `pnpm --filter @interdomestik/domain-membership-billing test:unit`
- [x] A15 - Add entity-bound webhook routes (`/api/webhooks/paddle/[entity]`). Verify: webhook route tests | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts' src/app/api/webhooks/paddle/route.test.ts` + `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-server.test.ts` + `pnpm pr:verify` (local fail `ENOTFOUND sq`) + `pnpm pr:verify:hosts` (local fail at `agent-workspace-claims-selection.spec.ts`) + `pnpm security:guard` + `pnpm e2e:gate` (initial local fail `ENOTFOUND mk`; host-routed rerun interrupted during Copilot follow-up) + `pnpm i18n:check`
- [x] A16 - Verify signature with exactly one entity secret; reject mismatch. Verify: webhook unit tests | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts'` (3 passed) + `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/_core.test.ts'` (4 passed) + `pnpm pr:verify` (local fail at `e2e/gate/agent-workspace-claims-selection.spec.ts`: missing `workspace-selected-claim-id`) + `pnpm security:guard` (passed) + `pnpm e2e:gate` (75 passed, 7 skipped) + `pnpm i18n:check` (passed) + `pnpm pr:finalize` (initial local fail: working tree not clean before commit)
- [x] A17 - Add idempotency + provider transaction linkage constraints. Verify: replay tests + DB constraints | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/_core.test.ts'` (6 passed) + `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts'` (3 passed) + `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-webhooks/persist.test.ts` (2 passed) + `pnpm db:migrations:check-journal` (passed) + `pnpm pr:verify` (local fail at `e2e/gate/agent-workspace-claims-selection.spec.ts`: missing `workspace-selected-claim-id`) + `pnpm security:guard` (passed) + `pnpm e2e:gate` (75 passed, 7 skipped) + `pnpm i18n:check` (passed) + `pnpm pr:finalize` (initial local fail: working tree not clean before commit)
- [x] A18 - Add invoice and append-only ledger invariants by tenant/entity. Verify: invariant test suite | Date: 2026-02-23 | Evidence: `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-webhooks/invariants.test.ts` (5 passed) + `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-webhooks/persist.test.ts src/paddle-webhooks/handlers.test.ts` (5 passed) + `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/_core.test.ts'` (6 passed) + `pnpm db:migrations:check-journal` (passed) + `pnpm pr:verify` (local fail at `e2e/gate/agent-workspace-claims-selection.spec.ts`: missing `workspace-selected-claim-id`) + `pnpm security:guard` (passed) + `pnpm e2e:gate` (local fail at `e2e/gate/agent-workspace-claims-selection.spec.ts`: missing `workspace-selected-claim-id`) + `pnpm i18n:check` (passed) + `pnpm pr:finalize` (initial local fail: working tree not clean before commit; final pass after commit/push with PR #184 checks green)
- [ ] A19 - Add billing B1-B4 scenarios (KS/MK/AL + replay + wrong entity). Verify: billing scenario suite

### M2 Analytics (2026-03-23 to 2026-03-29)

- [ ] A20 - Instrument funnel + retention with tenant_id and variant. Verify: analytics validation scripts/reports

### M3 UX Conversion (2026-03-30 to 2026-04-05)

- [ ] A21 - Restore full funnel in hero-v2 and plan continuity. Verify: e2e + experiment checks

### M4 Evidence Streak (2026-04-06 to 2026-04-15)

- [ ] A22 - Complete 10 consecutive daily full-green RC runs. Verify: daily artifact packs in `tmp/release-streak/`

## Test Delta Checklist (use in every A12-A22 PR)

- [ ] Unit test delta added for changed logic files.
- [ ] Integration/e2e test delta added for changed boundary or user-flow behavior.
- [ ] No skip/fixme/quarantine introduced in required suites.
- [ ] Tracker evidence line includes exact test commands executed.

## Daily RC Run Checklist

- [ ] Run `pnpm security:guard`
- [ ] Run `REQUIRE_RLS_INTEGRATION=1 pnpm db:rls:test`
- [ ] Run `pnpm pr:verify:hosts`
- [ ] Run p0/p1/all release gate suites
- [ ] Run no-skip checker
- [ ] Run required-suite verifier
- [ ] Write rc.json evidence
- [ ] Capture daily streak artifact

## Notes Log (append newest first)

- 2026-02-24: A-I18N-W5 handoff status: Atlas locked scope to `apps/web/src/messages/{mk,sr}/{admin-dashboard,services,claims-tracking}.json` plus `scripts/i18n-purity-baseline.json` and this tracker file, confirming value-only edits with key/token stability and no TS/TSX/runtime/route/auth/proxy/tenant changes; Forge translated remaining EN-equal debt in the six scoped MK/SR namespaces while preserving placeholders/interpolation tokens (including `{date}` and markup tokens); Sentinel re-scan confirmed zero EN-equal entries and zero token mismatches across all six scoped locale files with no mixed-language scope drift; Gatekeeper mandatory-order evidence captured as `pnpm i18n:check` pass, first `pnpm i18n:purity:check` (pre-baseline) pass (`Current equal-to-base entries: 613`, `Resolved since baseline: 219`), `pnpm i18n:purity:baseline` pass (baseline refreshed to 613), second `pnpm i18n:purity:check` (post-baseline) pass (`Resolved since baseline: 0`), `pnpm pr:verify` local fail (`e2e/gate/agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped); Scribe updated the baseline snapshot and this tracker note.
- 2026-02-23: A-I18N-W4 Copilot follow-up status: Atlas kept scope locked to `apps/web/src/messages/{mk,sr}/admin-branches.json`, `apps/web/src/messages/mk/admin-claims.json`, and `scripts/i18n-purity-baseline.json` only; Forge translated remaining MK/SR `health.tooltip.*.bullets` arrays and normalized MK `next_actions.risk.sla` to a Latin-SLA form without key churn or runtime edits; Sentinel re-scan confirmed value-only updates, token/key integrity, and zero EN-equal regressions in touched namespaces; Gatekeeper reran mandatory order evidence as `pnpm i18n:check` pass, `pnpm i18n:purity:check` pass (`Current equal-to-base entries: 832`), `pnpm i18n:purity:baseline` pass (baseline refreshed to 832), `pnpm i18n:purity:check` pass (`Resolved since baseline: 0`), `pnpm pr:verify` local fail (`e2e/gate/agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped); Scribe logged this Copilot response pass for PR thread closure.
- 2026-02-23: A-I18N-W4 handoff status: Atlas locked scope to `apps/web/src/messages/{mk,sr}/{admin-claims,admin-branches,admin-settings}.json` + `scripts/i18n-purity-baseline.json` + tracker note and reconfirmed value-only/key-stable/token-preserving edits (no TS/TSX/runtime/route/auth/proxy/tenant changes); Forge translated EN-equal debt for MK/SR admin claims/branches/settings namespaces while preserving placeholders/interpolation tokens exactly; Sentinel parity scan confirmed no key churn, no token mismatches vs prior values, no mixed-language scope drift, and zero EN-equal leaves in all six scoped locale files; Gatekeeper evidence captured as `pnpm i18n:check` pass, `pnpm i18n:purity:check` pass (`Current equal-to-base entries: 832`, `Resolved since baseline: 142`), `pnpm i18n:purity:baseline` pass (baseline refreshed to 832), `pnpm i18n:purity:check` pass (`Resolved since baseline: 0`), `pnpm pr:verify` local fail (`e2e/gate/agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped); Scribe updated baseline snapshot and this tracker note.
- 2026-02-23: A-I18N-W2 handoff status: Atlas locked scope to `apps/web/src/messages/{mk,sr}/{admin-users,wizard,settings}.json` + `scripts/i18n-purity-baseline.json` + tracker note and reconfirmed value-only/key-stable/token-preserving edits (no TS/TSX/runtime/route/auth/proxy/tenant changes); Forge translated EN-equal debt for the first MK/SR high-impact remaining namespace set while preserving placeholder/interpolation syntax exactly; Sentinel parity scan confirmed no key churn, no token mismatches vs `en`, no mixed-language scope drift, and zero EN-equal leaves in all six scoped locale files; Gatekeeper evidence captured as `pnpm i18n:check` pass, `pnpm i18n:purity:check` pass (`Current equal-to-base entries: 974`), `pnpm i18n:purity:baseline` pass (baseline refreshed to 974), `pnpm i18n:purity:check` pass (`Resolved since baseline: 0`), `pnpm pr:verify` pass, `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped); Scribe updated baseline snapshot and this tracker note.
- 2026-02-23: A-I18N-W1 handoff status: Atlas locked scope to `apps/web/src/messages/{mk,sr}/{agent,common,nav}.json` + `scripts/i18n-purity-baseline.json` + tracker note and confirmed value-only edits (no key churn, no route/auth/proxy/tenant changes); Forge translated EN-equal debt in high-impact MK/SR namespaces with placeholders preserved and no TS/TSX/runtime changes; Sentinel re-scan confirmed zero EN-equal leaves in scoped `agent/nav` files and only brand-stable `common.companyName` remaining in `mk`/`sr`; Gatekeeper evidence captured as `pnpm i18n:check` pass, `pnpm i18n:purity:check` pass, `pnpm i18n:purity:baseline` pass, `pnpm i18n:purity:check` pass, `pnpm pr:verify` local fail (`e2e/gate/agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped); Scribe updated baseline snapshot and this tracker note.
- 2026-02-23: Added i18n integrity non-regression guardrail (baseline + CI/RC alerting) via `scripts/check-i18n-purity.mjs`, baseline snapshot `scripts/i18n-purity-baseline.json`, and CI/RC wiring; gate fails only on newly introduced mixed-language entries while historical translation debt is tracked and burned down separately.
- 2026-02-23: A18 handoff status: Atlas confirmed scoped A18 paths (`packages/domain-membership-billing/src/paddle-webhooks/invariants.ts`, `packages/domain-membership-billing/src/paddle-webhooks/invariants.test.ts`, `packages/domain-membership-billing/src/paddle-webhooks/index.ts`, `apps/web/src/app/api/webhooks/paddle/_core.ts`, `packages/database/src/schema/billing.ts`, `packages/database/src/schema/index.ts`, `packages/database/drizzle/0034_invoice_append_only_ledger_invariants.sql`, `packages/database/drizzle/meta/_journal.json`, tracker) and acceptance mapping (tenant/entity-scoped invoice invariants, append-only ledger trigger enforcement, replay-safe no-double-post constraints, DB-enforced guards/checks/indexes, invariant test suite, no `apps/web/src/proxy.ts` edits, no A19 matrix scope); Forge implemented billing invoice + ledger persistence invariants with tenant/entity scope checks and replay no-op behavior in webhook handling, plus DB constraints/triggers for append-only/history immutability and webhook scope consistency via migration `0034_invoice_append_only_ledger_invariants.sql`; Sentinel pre-review and post-review completed for billing/webhook boundary correctness with no auth/routing/tenant-architecture drift; Gatekeeper command evidence captured as `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-webhooks/invariants.test.ts` pass, `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-webhooks/persist.test.ts src/paddle-webhooks/handlers.test.ts` pass, `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/_core.test.ts'` pass, `pnpm db:migrations:check-journal` pass, `pnpm pr:verify` local fail (`agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` local fail (`agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm i18n:check` pass, `pnpm pr:finalize` initial local fail (working tree not clean) then pass after commit/push and green required CI on PR #184; Scribe updated A18 tracker evidence line and recorded explicit Atlas+Sentinel+Gatekeeper test-delta exception: no new integration/e2e test added in A18 because invariant behavior is covered with DB constraints + unit invariant suite and full scenario-matrix integration/e2e expansion is deferred to A19 (B1-B4 matrix scope).
- 2026-02-23: A17 handoff status: Atlas confirmed scoped A17 paths (`packages/domain-membership-billing/src/paddle-webhooks/persist.ts`, `apps/web/src/app/api/webhooks/paddle/_core.ts`, `apps/web/src/app/api/webhooks/paddle/[entity]/_core.ts`, `packages/database/src/schema/webhooks.ts`, `packages/database/drizzle/0033_webhook_scope_transaction_linkage.sql`, `packages/database/drizzle/meta/_journal.json`, `packages/domain-membership-billing/src/paddle-webhooks/persist.test.ts`, tracker) and acceptance criteria mapping (entity/tenant-scoped idempotency keys, provider transaction linkage persistence, DB-enforced unique constraints, replay tests, no A18/A19 scope creep, no `apps/web/src/proxy.ts` edits); Forge implemented scoped dedupe key generation and provider transaction identity extraction in webhook core plus persistence-layer linkage writes and conflict-no-op behavior, then added schema constraints and migration for `processing_scope_key` + scoped provider event/transaction uniqueness with replay-focused tests in `persist.test.ts` and entity-core delegation coverage updates; Sentinel pre-review and post-review completed for webhook/billing boundary correctness with no architecture drift or out-of-scope invariants; Gatekeeper command evidence captured as `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/_core.test.ts'` pass, `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts'` pass, `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-webhooks/persist.test.ts` pass, `pnpm db:migrations:check-journal` pass, `pnpm pr:verify` local fail (`agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped), `pnpm i18n:check` pass, `pnpm pr:finalize` initial local fail (working tree not clean); Scribe updated A17 tracker evidence line and recorded this handoff.
- 2026-02-23: A16 handoff status: Atlas confirmed scoped A16 paths (`apps/web/src/app/api/webhooks/paddle/[entity]/route.ts`, `apps/web/src/app/api/webhooks/paddle/[entity]/_core.ts`, `apps/web/src/app/api/webhooks/paddle/[entity]/route.test.ts`, `apps/web/src/app/api/webhooks/paddle/[entity]/_core.test.ts`, tracker) and acceptance criteria mapping (single entity secret for path entity, no generic fallback in entity-bound verification path, reject tenant/entity mismatch, no `apps/web/src/proxy.ts` edits, no A17/A18 idempotency/ledger scope); Forge implemented entity preflight webhook validation in `apps/web/src/app/api/webhooks/paddle/[entity]/_core.ts` and route wiring in `apps/web/src/app/api/webhooks/paddle/[entity]/route.ts` with focused unit coverage in `apps/web/src/app/api/webhooks/paddle/[entity]/route.test.ts` and `apps/web/src/app/api/webhooks/paddle/[entity]/_core.test.ts`; Sentinel pre-review and post-review completed for webhook boundary/security correctness with no scope creep; Gatekeeper command evidence captured as `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts'` pass, `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/_core.test.ts'` pass, `pnpm pr:verify` local fail (`e2e/gate/agent-workspace-claims-selection.spec.ts` missing `workspace-selected-claim-id`), `pnpm security:guard` pass, `pnpm e2e:gate` pass (75 passed, 7 skipped), `pnpm i18n:check` pass, `pnpm pr:finalize` initial local fail (working tree not clean); Scribe updated A16 tracker evidence line and recorded this handoff.
- 2026-02-23: A15 handoff status: Atlas confirmed scoped A15 paths (`apps/web/src/app/api/webhooks/paddle/[entity]/route.ts`, `apps/web/src/app/api/webhooks/paddle/[entity]/route.test.ts`, compatibility coverage in `apps/web/src/app/api/webhooks/paddle/route.test.ts`, tracker) and acceptance criteria (entity-bound webhook route, strict `ks|mk|al` path validation, fail-closed rate-limit posture, no `apps/web/src/proxy.ts` edits, no A16/A17/A18 logic changes); Forge implemented entity-scoped webhook routing using billing helpers (`resolveBillingEntityFromPathSegment`, `getPaddleAndConfigForEntity`) plus focused route coverage and Copilot follow-up dedupe plumbing in `packages/domain-membership-billing/src/paddle-server.ts`; Sentinel pre-review and post-review completed for webhook boundary changes with no scope creep; Gatekeeper command evidence captured as `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/webhooks/paddle/[entity]/route.test.ts' src/app/api/webhooks/paddle/route.test.ts` pass, `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-server.test.ts` pass, `pnpm pr:verify` local fail (`ENOTFOUND sq`), `pnpm pr:verify:hosts` local fail (`agent-workspace-claims-selection.spec.ts`), `pnpm security:guard` pass, `pnpm e2e:gate` initial local fail (`ENOTFOUND mk`) and host-routed rerun interrupted during Copilot follow-up, `pnpm i18n:check` pass; Scribe updated A15 tracker evidence line and recorded explicit Atlas+Sentinel+Gatekeeper exception for integration/e2e delta on this A15 webhook boundary change.
- 2026-02-23: A14 handoff status: Atlas confirmed scoped A14 paths (`packages/domain-membership-billing/src/paddle-server.ts`, `packages/domain-membership-billing/src/paddle-server.test.ts`, `.env.example`, tracker) and acceptance criteria (tenant->entity mapping for `tenant_ks|tenant_mk|tenant_al`, strict production-like env validation, explicit non-production fallback coverage, no webhook-route refactor); Forge implemented deterministic billing entity resolvers plus `resolveBillingEntityConfig`/`assertBillingEntityEnvConfigured` and added focused unit coverage in `src/paddle-server.test.ts`; Sentinel review completed for fail-closed env behavior in billing domain module; Gatekeeper command evidence captured as `pnpm --filter @interdomestik/domain-membership-billing test:unit --run src/paddle-server.test.ts` pass, `pnpm --filter @interdomestik/domain-membership-billing test:unit` pass, `pnpm pr:verify` local fail (`ENOTFOUND sq`), `pnpm security:guard` pass, `pnpm e2e:gate` local fail (`ENOTFOUND mk`); Scribe updated A14 tracker evidence line.
- 2026-02-23: Added mandatory test-delta policy for A12-A22 (unit + integration/e2e in same PR for behavior changes).
- 2026-02-23: A11 handoff status: Atlas confirmed A11 scope and sensitive endpoint list (`/api/auth/*`, `/api/register/*`, `/api/webhooks/paddle/*`, `/api/billing/*`, checkout-session creation endpoints, mutation-heavy claim endpoints) and repo applicability (`/api/billing/*` and checkout-session routes not present; claim mutation route applicable at `/api/uploads`); Forge implemented fail-closed production-sensitive behavior in `apps/web/src/lib/rate-limit.core.ts` with `RATE_LIMIT_BACKEND_MISSING` telemetry plus strict call-site wiring in `apps/web/src/app/api/auth/[...all]/route.ts`, `apps/web/src/app/api/register/route.ts`, `apps/web/src/app/api/webhooks/paddle/route.ts`, `apps/web/src/app/api/uploads/route.ts`; Sentinel pre-review completed for auth/api boundary paths before gate; Gatekeeper verified targeted unit evidence (`pnpm --filter @interdomestik/web test:unit --run src/lib/rate-limit.core.test.ts` and `pnpm --filter @interdomestik/web test:unit --run 'src/app/api/auth/[...all]/route.test.ts' src/app/api/register/route.test.ts src/app/api/webhooks/paddle/route.test.ts src/app/api/uploads/route.test.ts`) and owns final `pnpm pr:finalize` merge gate; Sentinel post-review completed for boundary-impacting updates.
- 2026-02-23: A10 handoff status: Atlas confirmed boundary-impacting scope/acceptance paths (`apps/web/src/features/member/claims/actions.ts`, `apps/web/src/app/api/uploads/route.ts`, `apps/web/src/app/api/uploads/_core.ts`, `apps/web/src/app/api/uploads/route.test.ts`, `apps/web/src/features/member/claims/actions.test.ts`) and A10 criteria (member-only claim upload ownership at route+action layer, safe deny, no path/upload URL leak); Forge implemented owner-scoped claim predicates in member upload actions with safe 404 responses and added ownership denial assertions in route tests + new action unit tests; Sentinel pre-review completed for auth/tenant/api boundary changes, Gatekeeper verified targeted unit test evidence command above, Sentinel post-review completed for boundary impact with no route contract changes.
- 2026-02-23: A09 handoff status: Atlas confirmed boundary-impacting scope/acceptance paths (`apps/web/src/lib/tenant/tenant-hosts.ts`, `apps/web/src/lib/proxy-logic.ts`, `apps/web/src/app/api/auth/[...all]/_core.ts`, `apps/web/src/app/api/register/route.ts`, `apps/web/src/app/api/simple-register/route.ts`), Forge implemented canonical source resolver and host/session fail-closed guard on `/api/register`, Sentinel pre-review completed for tenant/auth/api boundary changes, Gatekeeper verified targeted unit commands + gate isolation contract (`e2e/gate/tenant-resolution.spec.ts` on `gate-ks-sq` + `gate-mk-mk`); requested pilot scenario command with gate projects currently reports `No tests found` due project `testMatch` scoping, Sentinel post-review pending before merge.
- 2026-02-23: A08 handoff status: Atlas confirmed boundary-impacting scope (`packages/database/test/rls-engaged.test.ts` + RC workflow marker path), Forge implemented required-mode hard-fail behavior and integration-only marker emission, Sentinel pre-review completed for `packages/database` changes, Gatekeeper verified required/non-required/integration-capable command evidence (`REQUIRE_RLS_INTEGRATION=1 pnpm db:rls:test`, `pnpm db:rls:test`, `DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:54322/postgres REQUIRE_RLS_INTEGRATION=1 pnpm db:rls:test`); Sentinel post-review pending before merge.
- 2026-02-22: A07 handoff completed: Atlas confirmed A07 scope/touched files (`.github/workflows/security.yml`, `.github/workflows/secret-scan.yml`), Runway implemented rc/release triggers + blocking gitleaks CLI with SARIF artifact uploads, Gatekeeper verified `rg` policy check and PR/RC workflow evidence (`22287449326`, `22287449314`, `22287448408`, `22287448415`); Sentinel review not required (no boundary-owned product paths touched).
- 2026-02-22: A06 handoff completed: Atlas confirmed A06 slice/dependencies (`.github/workflows/release-candidate.yml` + tracker evidence update; A04/A05 present), Runway implemented RC orchestration, Gatekeeper verified formatting + RC branch run `22286625815` and artifact upload `release-candidate-artifacts-22286625815-1`; Sentinel review not required (no boundary-owned product paths touched).
- 2026-02-22: A05 handoff completed: Atlas confirmed scope/path (`apps/web/playwright.config.ts` only, no boundary-owned paths), Forge implemented reporter outputs, Gatekeeper verified gate command + reporter artifacts; Sentinel review not required.
- 2026-02-22: A04 handoff completed: Atlas confirmed A04 scope/dependencies (`scripts/release-gate/streak/*` + tracker evidence update), Runway implemented, Gatekeeper verified via required local commands; Sentinel review not required (no boundary-owned paths touched).
- 2026-02-22: A04 completed (added streak anchor/capture scripts with repo-relative path handling, immutable run directory policy, and pack-level SHA256 checksums).
- 2026-02-22: A03 completed (RC evidence manifest writer added; emits `rc.json` and `rc.json.sha256`, with `checks.rls_integration_ran=true` from `rls.log` marker).
- 2026-02-22: A02 completed (no-skip checker added; required-suite scan currently reports existing `test.skip` violations as intended by policy).
- 2026-02-22: A01 completed (required-suite manifest created and validated).
- 2026-02-22: Tracker created and linked to operational plan.
